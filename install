#!/bin/sh
self=${0##*/}
prefix="$(dirname `realpath $0`)"
uid=`id -u`
uname=`uname`

[[ $uid -ne 0 ]]\
  && { printf "%s needs id=0 to proceed, got id=%s.\n" $self $uid; exit 1; }
[[ $uname -eq OpenBSD ]] && [[ -z $DOAS_USER ]]\
  && { printf "DOAS_USER not set.\n"; exit 1; }

while getopts "n" opt; do
  case $opt in
    n) export PRINT_ONLY=1;;
    *) echo "usage: $self [-n]"
	  exit 1;;
	esac
done

case $uname in
OpenBSD) user=$DOAS_USER;;
*) printf "Unsupported platform: %s.\n" $uname
  exit 1;;
esac

eval "$prefix/pkg/install"
eval "su $user -cm '$prefix/term/install; $prefix/xorg/install'"

